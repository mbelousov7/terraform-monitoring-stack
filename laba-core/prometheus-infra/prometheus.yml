global:
  scrape_interval: 60s
  scrape_timeout: 5s
  evaluation_interval: 1m
scrape_configs:

- job_name: 'node'
  file_sd_configs:
  - files:
    - '/etc/prometheus/file_sd_config/file_sd_config_test.json'
  basic_auth:
    username: admin
    password_file: /etc/prometheus/secrets/.password

- job_name: 'exporter-node'
  honor_timestamps: true
  scrape_interval: 1m
  scrape_timeout: 30s
  metrics_path: /metrics
  scheme: http
  relabel_configs:
    - source_labels: [__address__]
      separator: ;
      regex: ^(.*):\d+$
      target_label: instance
      replacement: $1
      action: replace
  file_sd_configs:
  - files:
    - '/etc/prometheus/file_sd_config/file_sd_config_test1.json'

- job_name: pods
  metrics_path: /metrics
  relabel_configs:
    - source_labels: [__meta_kubernetes_pod_label_system]
      target_label: system
    - source_labels: [__meta_kubernetes_pod_label_jmx-role]
      target_label: jmx-role
    - source_labels: [__meta_kubernetes_pod_label_instance]
      target_label: instance
      action: replace
  metric_relabel_configs:
    - separator: ;
      regex: exported_instance
      replacement: $1
      action: labeldrop
  kubernetes_sd_configs:
    - role: "pod"
      namespaces:
        names:
          - "monitoring"
      selectors:
        - role: "pod"
          label: "module=exporter-jmx,system=cdh-dc"
  bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token

- job_name: 'services'
  metrics_path: /metrics
  relabel_configs:
  - source_labels: [__meta_kubernetes_service_label_module]
    target_label: module
  - source_labels: [__meta_kubernetes_service_label_name]
    target_label: name
  bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
  kubernetes_sd_configs:
  - role: "service"
    namespaces:
      names:
        - "monitoring"
    selectors:
    - role: "service"
      label: "module=prometheus"
